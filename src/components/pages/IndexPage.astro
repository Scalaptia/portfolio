---
import LinkButton from "@/components/LinkButton.astro";
import ProjectsGrid from "@/components/ProjectsGrid";
import MoreAbout from "@/components/MoreAbout.astro";
import PCModel from "@/components/PCModel";
import Experience from "@/components/Experience";
import { Github, Linkedin, SendHorizontal, Download } from "lucide-react";
import CopyToClipboard from "@/components/CopyButton";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { getI18N } from "@/i18n/index";
import { parseMarkdown } from "@/utils/markdown";

const { currentLocale } = Astro;
const i18n = getI18N({ currentLocale });

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<main>
  <!-- Hero section -->
  <div
    slot="content"
    class="relative flex flex-col w-full lg:flex-row lg:flex-wrap lg:justify-between max-w-[600px] lg:max-w-[1000px] lg:gap-y-16 lg:items-center"
  >
    <!-- Developer -->
    <section
      class="w-full px-4 sm:px-6 lg:px-8 flex flex-col lg:max-w-[44ch] mb-64 lg:mb-0 relative z-10"
    >
      <span class="text-primary font-ubuntu-mono text-2xl relative z-10"
        >&lt;{i18n.TAG_DEVELOPER}&gt;</span
      >

      <h1
        class="pt-6 px-4 sm:px-[23px] lg:px-0 text-5xl sm:text-6xl font-black-han-sans text-text leading-[1.2em] text-center lg:text-left lg:max-w-[8ch] relative z-10 drop-shadow-sm"
      >
        <span
          id="hero-name-1"
          class="hero-name inline-block hover:text-primary hover:scale-110 transition-all duration-300 cursor-pointer select-none"
          >Fernando</span
        >
        <span
          id="hero-name-2"  
          class="hero-name inline-block hover:text-primary hover:scale-110 transition-all duration-300 cursor-pointer select-none"
          >Haro</span
        >
      </h1>

      <span
        class="text-primary font-ubuntu-mono text-2xl text-end lg:text-end lg:w-[26ch] relative z-10"
        >&lt;/{i18n.TAG_DEVELOPER}&gt;</span
      >
    </section>

    <!-- Model -->
    <div
      id="pc-model-container"
      class="pc-model-hero absolute left-1/2 -translate-x-1/2 w-[200px] h-[200px] sm:w-[240px] sm:h-[240px] lg:w-[240px] lg:h-[240px]
            top-[240px] sm:top-[300px] md:top-[150px] lg:top-[150px] lg:-translate-y-1/2 transition-all duration-300"
    >
      <PCModel client:only="react" />

      <div id="click-me-text" class="absolute bottom-0 left-1/2 -translate-x-1/2 text-center pointer-events-none transition-opacity duration-300">
        <p class="text-text/50 text-xs font-ubuntu-mono">
          {i18n.CLICK_ME || "Click me!"}
        </p>
      </div>
    </div>

    <!-- About -->
    <section
      class="w-full mt-12 px-4 sm:px-6 lg:px-8 flex flex-col text-center items-center lg:max-w-[44ch] lg:my-0 order-2 lg:order-none relative z-10"
    >
      <span
        class="text-primary text-start font-ubuntu-mono text-2xl self-start relative z-10"
        >&lt;{i18n.TAG_ABOUT}&gt;</span
      >

      <div
        class="py-6 text-xl font-open-sans text-text leading-[1.4em] flex flex-col gap-6 relative z-10"
      >
        <p set:html={parseMarkdown(i18n.TEXT_DESCRIPTION_1)} />
      </div>

      <span
        class="text-primary font-ubuntu-mono text-2xl text-end lg:text-end lg:w-[28ch] self-end relative z-10"
        >&lt;/{i18n.TAG_ABOUT}&gt;</span
      >
    </section>

    <!-- Links -->
    <div
      class="flex w-full justify-center mt-6 lg:mt-4 sm:w-auto lg:w-full items-center order-1 lg:order-none relative z-10"
    >
      <div class="grid grid-cols gap-6 sm:gap-8 px-4 sm:px-6 max-w-[600px] w-full sm:w-auto">
        <div class="grid grid-cols-1 sm:grid-cols-3 w-full gap-6">
          <LinkButton
            link="https://www.github.com/Scalaptia"
            text="GitHub"
            icon={Github}
          />
          <LinkButton
            link="https://www.linkedin.com/in/haro-fernando/"
            text="LinkedIn"
            icon={Linkedin}
          />
          <LinkButton
            link="/Resume_Fernando_Haro.pdf"
            text="Resume"
            icon={Download}
          />
        </div>

        <div
          class="flex bg-white text-text px-3 sm:px-6 py-3 sm:py-4 gap-2 sm:gap-4 justify-between items-center border-2 sm:border-4 border-text shadow-[2px_2px_0px_0px_rgba(65,44,71,1)] sm:shadow-[4px_4px_0px_0px_rgba(65,44,71,1)] min-w-0 w-full hover:shadow-[3px_3px_0px_0px_rgba(65,44,71,1)] sm:hover:shadow-[6px_6px_0px_0px_rgba(65,44,71,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
        >
          <span
            class="font-open-sans font-semibold pt-[1px] text-xs sm:text-sm lg:text-base truncate flex-1 min-w-0"
            >fernando.haro.c@gmail.com</span
          >

          <div class="flex gap-2 sm:gap-4 flex-shrink-0">
            <a
              href="mailto:fernando.haro.c@gmail.com"
              class="flex transition-all duration-150 hover:scale-110 hover:text-primary"
            >
              <SendHorizontal className="w-5 h-5" />
            </a>

            <CopyToClipboard
              client:visible
              text="fernando.haro.c@gmail.com"
              copiedText={i18n.TEXT_COPIED}
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Experience -->
  <div
    id="experience"
    slot="content"
    class="px-4 sm:px-6 lg:px-8 flex flex-col w-full items-center lg:flex-row lg:flex-wrap lg:justify-between max-w-[600px] lg:max-w-[1000px] lg:gap-y-8 my-8 lg:my-12 relative"
  >
    <span
      class="text-primary text-start font-ubuntu-mono text-2xl self-start w-full mb-6 relative z-10"
      >&lt;{i18n.TAG_EXPERIENCE}&gt;</span
    >
    <Experience experiences={i18n.EXPERIENCE} client:visible />
    <span
      class="text-primary font-ubuntu-mono text-2xl text-end w-full lg:text-end self-end mt-6 relative z-10"
      >&lt;/{i18n.TAG_EXPERIENCE}&gt;</span
    >
  </div>

  <!-- Projects -->
  <div
    id="projects"
    slot="content"
    class="px-4 sm:px-6 lg:px-8 flex flex-col w-full items-center lg:flex-row lg:flex-wrap lg:justify-between max-w-[600px] lg:max-w-[1000px] lg:gap-y-8 my-8 lg:my-12 relative"
  >
    <span
      class="text-primary text-start font-ubuntu-mono text-2xl self-start w-full mb-6 relative z-10"
      >&lt;{i18n.TAG_PROJECTS}&gt;</span
    >
    <ProjectsGrid
      projects={i18n.PROJECTS}
      translations={{
        keyContributions: i18n.TEXT_KEY_CONTRIBUTIONS,
        technologies: i18n.TEXT_TECHNOLOGIES,
      }}
      client:visible
    />
    <span
      class="text-primary font-ubuntu-mono text-2xl text-end w-full lg:text-end self-end mt-6 relative z-10"
      >&lt;/{i18n.TAG_PROJECTS}&gt;</span
    >
  </div>

  <!-- About Me -->
  <div
    id="about"
    slot="content"
    class="px-4 sm:px-6 lg:px-8 flex flex-col w-full items-center lg:flex-row lg:flex-wrap lg:justify-between max-w-[600px] lg:max-w-[1000px] my-8 lg:my-12 relative"
  >
    <span
      class="text-primary text-start font-ubuntu-mono text-2xl self-start w-full mb-6 relative z-10"
      >&lt;{i18n.TAG_ABOUT_ME}&gt;</span
    >
    <MoreAbout />
    <span
      class="text-primary font-ubuntu-mono text-2xl text-end w-full lg:text-end self-end mt-6 relative z-10"
      >&lt;/{i18n.TAG_ABOUT_ME}&gt;</span
    >
  </div>
</main>

<script>
  // Easter egg: Hero name hover triggers PC cat reaction
  const heroNames = document.querySelectorAll('.hero-name');
  
  heroNames.forEach(name => {
    name.addEventListener('mouseenter', () => {
      window.dispatchEvent(new CustomEvent('heroHover', { detail: { hovered: true } }));
    });
    
    name.addEventListener('mouseleave', () => {
      window.dispatchEvent(new CustomEvent('heroHover', { detail: { hovered: false } }));
    });
  });

  // Clear sticky styles so CSS classes take over again (no position jump)
  function returnToHero() {
    const pcContainer = document.querySelector('#pc-model-container') as HTMLElement;
    if (!pcContainer) return;
    
    pcContainer.style.removeProperty('position');
    pcContainer.style.removeProperty('bottom');
    pcContainer.style.removeProperty('right');
    pcContainer.style.removeProperty('left');
    pcContainer.style.removeProperty('top');
    pcContainer.style.removeProperty('transform');
    pcContainer.style.removeProperty('width');
    pcContainer.style.removeProperty('height');
    pcContainer.style.removeProperty('z-index');
  }

  // Make PC sticky when scrolling (only on desktop)
  window.addEventListener('scroll', () => {
    // Skip sticky behavior on mobile
    if (window.innerWidth < 1024) return;
    
    const pcContainer = document.querySelector('#pc-model-container') as HTMLElement;
    const clickMeText = document.querySelector('#click-me-text') as HTMLElement;
    
    if (pcContainer) {
      if (window.scrollY > 400) {
        // Make sticky
        pcContainer.style.position = 'fixed';
        pcContainer.style.bottom = '2rem';
        pcContainer.style.right = '2rem';
        pcContainer.style.left = 'auto';
        pcContainer.style.top = 'auto';
        pcContainer.style.transform = 'none';
        pcContainer.style.width = '180px';
        pcContainer.style.height = '180px';
        pcContainer.style.zIndex = '50';
        
        if (clickMeText) clickMeText.style.opacity = '0';
      } else {
        // Back to normal
        returnToHero();
        if (clickMeText) clickMeText.style.opacity = '1';
      }
    }
  });

  // On resize: if sticky and now mobile/tablet, clear sticky so classes apply
  window.addEventListener('resize', () => {
    const pcContainer = document.querySelector('#pc-model-container') as HTMLElement;
    if (!pcContainer) return;
    if (pcContainer.style.position === 'fixed' && window.innerWidth < 1024) {
      returnToHero();
      const clickMeText = document.querySelector('#click-me-text') as HTMLElement;
      if (clickMeText) clickMeText.style.opacity = '1';
    }
  });

  // Subtle interactions with page elements
  document.addEventListener('DOMContentLoaded', () => {
    // React when hovering over project cards
    const projectCards = document.querySelectorAll('[class*="border-4"]');
    projectCards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        window.dispatchEvent(new CustomEvent('pageInteraction', { detail: { type: 'project', hovered: true } }));
      });
      card.addEventListener('mouseleave', () => {
        window.dispatchEvent(new CustomEvent('pageInteraction', { detail: { type: 'project', hovered: false } }));
      });
    });

    // React when clicking social links
    const socialLinks = document.querySelectorAll('a[href*="github"], a[href*="linkedin"]');
    socialLinks.forEach(link => {
      link.addEventListener('click', () => {
        window.dispatchEvent(new CustomEvent('pageInteraction', { detail: { type: 'social' } }));
      });
    });

    // React when email is copied
    window.addEventListener('emailCopied', () => {
      window.dispatchEvent(new CustomEvent('pageInteraction', { detail: { type: 'email' } }));
    });
  });
</script>
